# Socket Security GitHub Actions Workflow
# Runtime reachability analysis.
# Scans and populates the Socket.dev UI

name: socket-security-workflow
run-name: Socket Security Github Action

on:
  schedule:
    - cron: "0 16 * * 1" # Runs at 9 AM Mountain Time every Monday
  workflow_dispatch:

# Prevent concurrent runs for the same commit
concurrency:
  group: socket-scan-scheduled
  cancel-in-progress: true

jobs:
  socket-security:
    permissions:
      contents: read
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Install Socket CLI
        run: |
          pip install socketsecurity --upgrade
          pip install npm --upgrade
          pip install uv --upgrade
          pip install npx --upgrade
      
      - name: Run Socket Security Scan
        env:
          SOCKET_SECURITY_API_KEY: ${{ secrets.SOCKET_SECURITY_API_KEY }}
          GH_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          socketcli --version
          socketcli --target-path $GITHUB_WORKSPACE --reach --scm github
